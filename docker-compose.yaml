services:
  osm-extractor-workflow-start:
    container_name: osm-extractor-workflow-start
    env_file:
      - path: .env.development.local
        required: true
    environment:
      TEMPORAL_URL: host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"
    image: osm-extractor
    labels:
      - 'app=osm-extractor-workflow-start'
    command: ['./cmd', 'create']
  osm-extractor-worker:
    container_name: osm-extractor-worker
    env_file:
      - path: .env.development.local
        required: true
    environment:
      TEMPORAL_URL: host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"
    image: osm-extractor
    labels:
      - 'app=osm-extractor-worker'
    volumes:
      - ./volumes/input:/mnt/input 
      - ./volumes/output:/mnt/output
    command: ['./cmd', 'worker']
    depends_on:
      osm-extractor-workflow-start:
        condition: service_completed_successfully
  osm-extractor-workflow-resume:
    profiles: ['resume']
    container_name: osm-extractor-workflow-resume
    env_file:
      - path: .env.development.local
        required: true
    environment:
      TEMPORAL_URL: host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"
    image: osm-extractor
    labels:
      - 'app=osm-extractor-workflow-resume'
    command: ['./cmd', 'resume']
  osm-extractor-workflow-pause:
    profiles: ['pause']
    container_name: osm-extractor-workflow-pause
    env_file:
      - path: .env.development.local
        required: true
    environment:
      TEMPORAL_URL: host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"
    image: osm-extractor
    labels:
      - 'app=osm-extractor-workflow-pause'
    command: ['./cmd', 'pause']